<div class="draftWatermark"></div>

# 练习8 - 使用SAP Build Code和Joule副驾创建应用程序

---
# SAP Build Code 和 Joule 副驾助手
## 概述
在这一单元中，我们要创建一个客户忠诚度计划的应用程序。客户可以通过购买产品获得积分，并可以使用这些积分进行兑换。

借助Joule的生成式AI能力在SAP Build Code中创建应用程序。

1. 数据模型和服务创建
2. 示例数据
3. 应用逻辑

<br>
<br>

### SAP Build Code 简介

SAP Build Code 是一个集成运行时和设计时间能力的全栈开发环境，内置了DevOps和应用生命周期管理解决方案。

![](vx_images/586596853168213.jpg)

### SAP Build Code 的优势

* 通过与SAP Build Code并行扩展来实现干净的核心
* 使用生成式AI、生产力工具和应用生命周期管理优化开发效率
* 允许开发人员使用他们选择的编程语言构建和扩展强大的端到端业务应用程序
* 实现经典开发工具与低代码开发工具之间的互操作性

### SAP Build Code的功能特点
* 通过稳定的未来保障基础来区分云解决方案，使解决方案具备未来安全性，并能在不同的S/4HANA版本中工作且包含质量保证选项
* 允许开发人员更快更智能的编码，代码生成基于生成式AI，简化应用生命周期管理
* 应用和扩展开发，集成SAP及非SAP系统
* 通过中央大堂提供给所有类型的开发人员便捷访问，实现融合开发

### 创建项目
这个教程的起点是SAP Build的大堂，这是所有SAP Build产品的中央入口点。

1. 启动SAP Build大堂（如果你还没有在大堂里）
2. 点击创建按钮
   ![](vx_images/197476675768242.jpg)

3. 选择构建应用
   ![](vx_images/294907292022514.jpg)

4. 选择SAP Build Code
   ![](vx_images/377155954262791.jpg)

5. 选择全栈应用
   ![](vx_images/203846331177604.jpg)

6. 在下一个屏幕上输入以下信息：
   | 输入字段   |           输入值                   |
   | --------------------------| ----------------------------------------------|
   | 项目名称 | Customer_Loyal_XXX                            |
   | 描述       | 客户忠诚计划模型和服务的名称 XXX |

   ![](vx_images/169730972959447.png)
   
7. 点击创建按钮。
   * 项目的创建可能需要一分钟的时间。

8. 点击Customer_Loyal_XXX项目。
   ![](vx_images/555362819544506.jpg)

9. 系统可能会提示你确认Cookie设置，请点击确定（或打开设置以更新设置）。
   ![](vx_images/357583453270556.png)

10. SAP Build Code 将基于SAP Business Application Studio打开。
  * 请等待一段时间以使Build Code 打开！
   ![](vx_images/243353682117047.jpg)

---

### 使用Joule创建数据实体
在本课中，我们将为客户忠诚度计划应用创建数据模型和服务。

我们可以通过Storyboard绘制视觉模型或手动编写代码来创建数据模型，但我们将使用Joule和SAP Build Code的生成式AI能力来生成代码。此方法可以显著减少开发客户忠诚度计划应用所需的时间和精力。

1. 启动Joule数字助手。
  * 请等待数字助手打开。如果无法打开，请刷新你的浏览器。

![](vx_images/127936581646904.png)

2. 让Joule生成CAP应用，请在提示框中输入**/cap-gen-app**。

![](vx_images/53742961754897.png)

4. 复制并粘贴提示框中的内容到Joule的“Ask Joule”区域中生成数据模型和服务：
> 设计一个客户忠诚度计划应用。定义三个数据实体：Customers（顾客）、Purchases（购买）和Redemptions（兑换）。每个顾客必须包含如下字段：姓名、邮箱、七位数字的客户号码、总购入金额（整数）、累计积分奖励点数和已使用积分奖励点数。除了姓名和邮箱（存储为字符串），所有字段均为整数。购买包含如下字段：购入金额、积分奖励点数和选定产品（除了选定的产品其他均为整数）。兑换包含一个字段：已使用金额（整数），每个购买或兑换都关联到一位顾客。请使用关联而不是组合。

5. 点击“生成”。
   ![](vx_images/41854164674294.png)

6. 现在你的提示框下方会生成代码。
   ![](vx_images/125626629808930.png)

7. 点击接受图标以确认代码。
  * 接受代码后，你将在右侧的Storyboard标签页看到更新内容。
   Joule将在2分钟内为你创建数据模型和服务。

![](vx_images/482985509683569.png)

---

### 使用Joule增强数据
在本课中，我们将使用Joule和SAP Build Code的生成式AI能力来生成一些示例数据。这些示例数据将用于测试和预览我们的客户忠诚度计划应用的后端服务。

#### 增强顾客初始数据
1. 打开“数据编辑器”。导航至“打开编辑器”，然后选择“样本数据”。

![](vx_images/119833407682871.png)

2. 选择“顾客”数据实体，然后点击“初始数据”标签页。

![](vx_images/408741525965211.png)

3. 输入“5”到“行数”的字段。点击“添加”按钮以增加该实体的5条记录。

![](vx_images/107321469420053.png)

4. 点击“增强”。这将再次打开Joule以修改示例数据。

![](vx_images/468752316290484.png)

5. 复制以下提示内容并粘贴到Joule，然后点击“生成”：
> 用有意义的数据增强我的示例数据。所有的客户号码均为七位数字，其中一个顾客必须使用1200547这个编号。任何字段都不能留空。总购入金额必须小于10000，积分奖励点数和已使用积分奖励点数均为非零且不同，并且每个客户的总购入金额的十分之一。

![](vx_images/351723722964513.png)

* 你可以看到你的提示框下方的顾客名称、电子邮件地址和购买金额已被创建。

6. 点击“接受”以批准Joule生成的示例客户数据。
   ![](vx_images/338272400160993.png)

7. 你将看到列表中的一个客户编号已经被更新为 **1200547**。

![](vx_images/150612189058058.png)

#### 增强购买初始数据
1. 选择“购买”数据实体。
2. 点击“初始数据”标签页。
3. 输入“5”到“行数”的字段。
4. 点击“添加”按钮以增加该实体的5条记录。

![](vx_images/431502492426144.png)

5. 赋予每个购买记录唯一的客户ID。

![](vx_images/345201521309822.png)

6. 点击“增强”。

7. 复制以下文本作为Joule提示内容：
> 使用办公电子产品的示例数据生成有意义的数据。每笔“购买金额”的范围在50到1000之间，确保每个“积分奖励点数”始终是购买金额的十分之一。确保“客户”字段已填充。

8. 将复制的文本粘贴到Joule提示框中，点击“生成”。

![](vx_images/113492829099379.png)

* 等待Joule ... 思考... 并生成数据。AI的生成可能需要一些时间。

9. 接受Joule生成的代码。
   ![](vx_images/454122548511379.png)

10. 更新“购买”的初始数据。

![](vx_images/235793007763464.png)

#### 增强兑换初始数据
1. 选择“兑换”数据实体。
2. 点击“初始数据”标签页。
3. 输入“5”到“行数”的字段。
4. 点击“添加”按钮以增加该实体的5条记录。

![](vx_images/480783634708974.png)

5. 赋予每个记录唯一的客户ID。

![](vx_images/263322977623469.png)

6. 点击“增强”。

7. 使用以下提示内容：
> 确保每笔兑换金额不相同且在10到100之间。

8. 点击“生成”。此过程可能需要一些时间。

![](vx_images/460213679916260.png)

9. 接受Joule生成的代码。
   ![](vx_images/132414545510681.png)

10. 更新“兑换”的初始数据。

![](vx_images/377152774133888.png)

---

### 使用Joule创建后端逻辑
我们已经使用Joule创建了实体、服务和示例数据。在本课程中，我们将添加一些逻辑到应用中。我们希望计算每个客户的购买积分，并提供客户使用这些积分的逻辑。

#### 购买后端逻辑
1. 在Storyboard中点击服务下的一个实体，并“以图形建模器打开”

![](vx_images/337123132255085.png)

2. 点击标题选择“购买”实体。
   * 注意：如果你看不到“购买”实体，可能需要缩放视图。

3. 点击“添加逻辑”。

   ![](vx_images/270594874622771.png)

4. 保持默认值不变，并点击“添加”。

   ![](vx_images/592245476915562.png)

5. 选择标准事件“创建”。
   * 这意味着当新购买发生时，此逻辑将自动执行。

6. 导航至“打开代码编辑器> 应用逻辑”。

   ![](vx_images/453483400435578.png)

7. 使用以下提示内容，在Joule中创建后端逻辑：
> 每次购买的积分奖励点数为其购入金额的十分之一。每个购入金额会添加到相关的客户总购入金额中。每个积分奖励点数会添加到相关的客户的累计积分奖励点数中。

8. 点击“生成”。

   ![](vx_images/427444696065977.png)

9. Joule生成了以下逻辑：
   * 检查客户是否存在
   * 计算购入金额的积分奖励点数
   * 更新客户的总购入金额和累计积分奖励点数

10. 点击“接受”以保存Joule生成的代码。
    * Joule可能为相同的提示生成不同的代码，但只要达到相同的结果即可忽略其差异。

   ![](vx_images/552223300559334.png)

#### 兑换后端逻辑
接下来我们处理兑换。

1. 返回到服务界面。
2. 点击“兑换”的标题以添加逻辑。

   ![](vx_images/21235993065279.png)

4. 点击“添加”。

   ![](vx_images/372634497558636.png)

5. 选择“创建”。

6. 导航至“打开代码编辑器”中的应用逻辑。

   ![](vx_images/235963709672633.png)

7. 使用以下提示内容在Joule中创建后端逻辑：
> 从相关的客户的累计积分奖励点数减去兑换金额。将相同的金额添加到该客户已使用积分奖励点数中。

   ![](vx_images/33424744587762.png)

8. 点击“接受”以保存Joule生成的代码。
   ![](vx_images/229864663938016.png)

9. 查看生成的代码，它包含了一些逻辑来检查客户是否有足够的积分进行兑换。

   * Joule可能为相同的提示生成不同的代码，只要其功能相同即可忽略差异并继续练习。

10. 返回到Storyboard，并打开服务中心。
   ![](vx_images/528483625249717.png)

---

### 添加外部数据资源
在本课中，我们将连接到S4/HANA系统以获取与产品相关的数据。

下载示例目标文件 S/4HANA Cloud [ADOPTION_LAB_API_PRODUCT](https://robin-qiu.github.io/BTP-CAP-Development-with-SAP-Build-Code---Bring-Your-Own-Tenant/vx_attachments/477573873607615/ADOPTION_LAB_API_PRODUCT)

1. 将目标 ADOPTION_LAB_API_PRODUCT 导入你的BTP系统。
   ![](vx_images/268533670435638.png)

1. 在“服务中心”中，前往“SAP系统”，找到BTP目标ADOPTION_LAB_API_PRODUCT（S/4产品）。
2. 选择“添加到CAP项目”

**注意**: 此目标已由你的子账户管理员配置。该目标连接到SAP Business Hub的沙盒API。有关此API的更多信息，请访问[SAP Business Accelerator Hub](https://api.sap.com/api/API_PRODUCT_SRV/overview)

   ![](vx_images/25655210989567.png)

3. 转到Storyboard，检查外部资源是否已更新。
   **注意**: 更新可能需要一些时间！

   ![](vx_images/482855277645426.png)

4. 转到服务界面，并添加实体。
   你可以将新实体放置在任何位置。

   ![](vx_images/413955362650241.png)

5. 选择数据实体：**ADOPTION_LAB_API_PRODUCT.A_ProductBasicText**
   * 禁用“启用草稿编辑”选项。
6. 点击保存
   ![](vx_images/490104387866818.png)

---

### 用户界面应用
在这一课中，你将设计一个用户界面向客户展示我们为忠诚度项目应用开发的内容。

1. 返回到Storyboard，并通过选择“+”号来添加第一个UI应用。
   ![](vx_images/115205804971320.jpg)

2. 我们将从数据实体“购买”的用户界面开始。输入以下值：
   显示名称：**购买**
   描述： **管理购买**
   数据源： **customer_loyal_XXXSrv**

![](vx_images/265166972065888.jpg)

3. 点击“下一步”。
   ![](vx_images/586037151200874.png)

4. 选择“基于模板的响应式应用”作为UI应用类型。
   ![](vx_images/250106459463611.jpg)

5. 点击“下一步”。
   ![](vx_images/517215672261806.png)

6. 选择“列表报告页面”。
   ![](vx_images/242806920304772.jpg)

7. 点击“下一步”。
   ![](vx_images/582926139322076.png)

8. 选择“购买”实体。
9. 点击完成。

   ![](vx_images/388576499026545.jpg)

10. 如果需要，关闭页面映射。
重复相同步骤以处理“客户”和“兑换”实体。

- 客户：
  - 显示名称：**顾客**
  - 描述： **管理顾客**
  - 数据源： **customer_loyal_XXXSrv**
- UI应用类型：**基于模板的响应式应用**
- UI应用模板：**列表报告页面**
- 主实体：**顾客**

    - 等待UI创建完成。你将看到一条消息，表示文件已生成。

Redemptions：
* 显示名称：**兑换**
* 描述：**管理兑换**
* 数据源： **customer_loyal_XXXSrv**
* UI应用类型：**基于模板的响应式应用**
* UI应用模板：**列表报告页面**
* 主实体：**兑换**

---

### 修改购买的UI
现在我们将修改购买的UI。我们将包括从S/4HANA的产品作为值帮助，并隐藏一些字段。

1. 返回到Storyboard。
2. 点击“购买UI”并在页面映射中打开它。

为了识别哪个是购买UI，请将鼠标指针悬停在UI上以展开显示名称。
   ![](vx_images/132840397831215.jpg)

3. 我们想要修改“对象页面”。因此请选择编辑图标。
   ![](vx_images/432150496028276.jpg)

4. 在部分中，展开**一般信息**,然后展开**表单**然后再展开**字段**。 
   后来会像这样：
   
![修改后的界面](vx_images/462871169950878.jpg)

奖励点数将由Joule生成的逻辑自动计算。

5. 删除“奖励点数”字段，请点击旁边的垃圾桶图标并确认删除。
   ![](vx_images/566080401342073.jpg)

相反，我们希望选择S/4HANA的产品进行购买。

6. 选择字段“选定产品”，并将其显示类型设置为**值帮助**。
   设置如下：
   
    * 标签：**产品**
    * 值来源实体：**A_ProductBasicText**

7. 点击应用。

   ![](vx_images/499141603923593.jpg)

---

### 预览
本课中，我们将审查你刚创建的客户忠诚度计划应用。

1. 若要预览你的应用程序，请前往右上角，选择“运行和调试”。
   ![](vx_images/364501825006721.png)

2. 选择运行customer_loyal_XXX。
   ![](vx_images/149752164668187.png)

3. 应用程序的预览将显示出来。
   ![](vx_images/371802368887084.png)

4. 点击“开始”并浏览每个功能图块（**顾客、购买和兑换**）以查看生成的数据。请注意，在应用程序预览中，可能并非所有功能都可用。
   ![](vx_images/222451221840794.png)

恭喜你！你已经成功地使用**SAP Build Code**和Joule副驾构建并预览了一个CAP应用！

---